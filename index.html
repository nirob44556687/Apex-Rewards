<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>APEX REWARDS</title>
    
    <!-- SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://adsgram.ai/js/adsgram-ad-sdk.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #02050a;
            --primary: #1E90FF;
            --secondary: #9B59B6;
            --accent: #2ECC71;
            --card: #0d1117;
            --border: rgba(255, 255, 255, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }
        body { background: var(--bg); color: #fff; height: 100vh; width: 100vw; overflow: hidden; }

        /* Welcome Popup */
        #welcome-popup { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; padding: 25px; }
        .notice-card { background: var(--card); border: 2px solid var(--primary); padding: 30px; border-radius: 30px; text-align: center; width: 100%; max-width: 400px; }

        /* Main Container */
        #app-wrapper { height: 100vh; display: flex; flex-direction: column; display: none; }
        header { padding: 15px 20px; background: #0f172a; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }

        /* Pages */
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Balance Card */
        .balance-card { background: linear-gradient(135deg, #1e293b, #02050a); padding: 25px; border-radius: 25px; text-align: center; border: 1px solid var(--border); margin-bottom: 20px; }
        .balance-card h1 { font-size: 45px; font-weight: 900; color: var(--primary); }

        /* Big Ad Button */
        .watch-btn { background: linear-gradient(45deg, var(--primary), var(--secondary)); border: none; padding: 35px 20px; border-radius: 25px; color: #fff; width: 100%; font-weight: 800; cursor: pointer; font-size: 18px; box-shadow: 0 10px 20px rgba(30,144,255,0.3); margin-top: 10px; }
        .watch-btn:active { transform: scale(0.96); }

        /* List Items (Rank/Wallet) */
        .list-item { background: var(--card); border: 1px solid var(--border); padding: 15px; border-radius: 18px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; border: 1px solid var(--primary); margin-right: 12px; }

        /* Bottom Navigation */
        nav { position: fixed; bottom: 0; left: 0; right: 0; height: 80px; background: rgba(13, 20, 37, 0.95); backdrop-filter: blur(15px); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-item { flex: 1; text-align: center; color: #64748b; cursor: pointer; transition: 0.3s; padding: 10px 0; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
        .nav-item span { font-size: 11px; font-weight: 600; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active i { filter: drop-shadow(0 0 5px var(--primary)); }
    </style>
</head>
<body>

    <!-- ১. ওয়েলকাম স্ক্রিন -->
    <div id="welcome-popup">
        <div class="notice-card">
            <h1 style="color: var(--primary); margin-bottom: 15px;">APEX REWARDS</h1>
            <p style="color: #8b949e; line-height: 1.6; margin-bottom: 25px;">
                স্বাগতম! ভিডিও অ্যাড দেখে ইনকাম শুরু করুন। <br>
                <b>১০০০ কয়েন = ১.৫০ টাকা</b><br>
                উইথড্র লিমিট: ১,০০,০০০ কয়েন।
            </p>
            <button onclick="startApp()" style="width: 100%; background: var(--primary); border:none; padding: 18px; border-radius: 20px; font-weight: 800; font-size: 16px; cursor: pointer; color: #000;">শুরু করুন</button>
        </div>
    </div>

    <!-- ২. মেইন অ্যাপ ইন্টারফেস -->
    <div id="app-wrapper">
        <header>
            <div style="display: flex; align-items: center; gap: 10px;">
                <img id="user-photo" src="https://via.placeholder.com/40" style="border-radius: 50%; width: 38px; border: 1px solid var(--primary);">
                <span id="user-name" style="font-weight: bold; font-size: 14px;">User</span>
            </div>
            <h3 style="letter-spacing: 2px; color: var(--primary);">APEX</h3>
        </header>

        <div class="content">
            <!-- HOME PAGE -->
            <div id="home-page" class="page active">
                <div class="balance-card">
                    <p style="color: #64748b; font-size: 12px; letter-spacing: 1px;">TOTAL BALANCE</p>
                    <h1 id="coins-bal">0</h1>
                    <p style="color: var(--accent); font-weight: bold;">≈ <span id="taka-bal">0.00</span> BDT</p>
                </div>
                
                <div style="background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid var(--border); font-size: 13px; display: flex; justify-content: space-between;">
                    <span>আজকের কাজ: <b id="daily-count">0</b> / <span id="daily-limit">0</span></span>
                    <span style="color: var(--accent);"><i class="fas fa-check-circle"></i> Active</span>
                </div>

                <button class="watch-btn" onclick="handleWatchAd()">
                    <i class="fas fa-play-circle" style="font-size: 40px; margin-bottom: 10px;"></i><br>
                    WATCH AD & EARN 25 COINS
                </button>
            </div>

            <!-- RANK PAGE -->
            <div id="rank-page" class="page">
                <h3 style="margin-bottom: 15px;"><i class="fas fa-trophy" style="color: gold;"></i> Global Leaderboard</h3>
                <div id="leaderboard-list">
                    <!-- ১০০ জন ফেক ইউজার এখানে আসবে -->
                </div>
            </div>

            <!-- WALLET PAGE -->
            <div id="wallet-page" class="page">
                <h3>Withdraw Balance</h3><br>
                <div class="balance-card">
                    <p>উত্তোলনযোগ্য কয়েন</p>
                    <h2 id="wallet-coins" style="font-size: 35px; color: var(--accent);">0</h2>
                </div>
                <div style="background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid var(--border);">
                    <label style="font-size: 12px; color: #64748b;">পেমেন্ট মেথড:</label>
                    <select id="withdraw-methods" style="width: 100%; padding: 15px; background: #000; color: #fff; border: 1px solid var(--border); border-radius: 12px; margin: 10px 0 20px;"></select>
                    
                    <label style="font-size: 12px; color: #64748b;">একাউন্ট নাম্বার:</label>
                    <input type="number" placeholder="বিকাশ/নগদ নাম্বার দিন" style="width: 100%; padding: 15px; background: #000; color: #fff; border: 1px solid var(--border); border-radius: 12px; margin: 10px 0 20px;">
                    
                    <button id="withdraw-submit" disabled style="width: 100%; padding: 18px; background: #333; color: #888; border: none; border-radius: 15px; font-weight: bold;">উইথড্র রিকোয়েস্ট পাঠান</button>
                </div>
            </div>
        </div>

        <nav>
            <div class="nav-item active" onclick="navTo('home-page', this)"><i class="fas fa-home"></i><span>Home</span></div>
            <div class="nav-item" onclick="navTo('rank-page', this)"><i class="fas fa-trophy"></i><span>Rank</span></div>
            <div class="nav-item" onclick="handleWatchAd()"><i class="fas fa-play-circle" style="color: var(--primary);"></i><span>Ads</span></div>
            <div class="nav-item" onclick="navTo('wallet-page', this)"><i class="fas fa-wallet"></i><span>Wallet</span></div>
        </nav>
    </div>

    <script>
        // --- ১. ফায়ারবেস সেটিংস (Firebase Configuration) ---
        const firebaseConfig = {
            apiKey: "AIzaSyCkaZgZuzFtnkuHiheY_0ojMIbr8rv5Jpw",
            authDomain: "shopbasebd.firebaseapp.com",
            databaseURL: "https://shopbasebd-default-rtdb.firebaseio.com",
            projectId: "shopbasebd",
            storageBucket: "shopbasebd.firebasestorage.app",
            messagingSenderId: "210431868233",
            appId: "1:210431868233:web:833f040b499804ef742e98"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- ২. টেলিগ্রাম ও অ্যাডসগ্রাম (SDK Init) ---
        const tg = window.Telegram.WebApp;
        tg.expand();
        const AdController = window.Adsgram.init({ blockId: "22538" });

        let userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "12345678";
        let uName = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : "User";
        let uPic = tg.initDataUnsafe.user?.photo_url || "https://api.dicebear.com/7.x/avataaars/svg?seed=user";

        const COIN_RATE = 1.50 / 1000; // 1000 coins = 1.50 BDT
        const MIN_WITHDRAW = 100000;

        // --- ৩. ডাটা সিঙ্ক (Real-time Sync) ---
        db.ref('users/' + userId).on('value', (snap) => {
            let user = snap.val() || { coins: 0, dailyAds: 0, lastDate: "", name: uName, photo: uPic };
            updateUserUI(user);
        });

        // এডমিন সেটিংস লোড
        db.ref('settings').on('value', (snap) => {
            const settings = snap.val() || { dailyLimit: 50 };
            document.getElementById('daily-limit').innerText = settings.dailyLimit;
            window.maxLimit = settings.dailyLimit;

            let options = "";
            if(settings.methods) {
                Object.values(settings.methods).forEach(m => options += `<option>${m}</option>`);
            }
            document.getElementById('withdraw-methods').innerHTML = options;
        });

        function updateUserUI(user) {
            let coins = user.coins || 0;
            let today = new Date().toDateString();
            let dailyCount = (user.lastDate === today) ? user.dailyAds : 0;

            document.getElementById('coins-bal').innerText = coins.toLocaleString();
            document.getElementById('wallet-coins').innerText = coins.toLocaleString();
            document.getElementById('taka-bal').innerText = (coins * COIN_RATE).toFixed(2);
            document.getElementById('daily-count').innerText = dailyCount;
            document.getElementById('user-name').innerText = uName;
            document.getElementById('user-photo').src = uPic;

            // Withdraw Button Logic
            const btn = document.getElementById('withdraw-submit');
            if(coins >= MIN_WITHDRAW) {
                btn.disabled = false; btn.style.background = "var(--primary)"; btn.style.color = "#000";
            } else {
                btn.disabled = true; btn.style.background = "#333"; btn.style.color = "#888";
            }
        }

        // --- ৪. নেভিগেশন (Navigation Logic) ---
        function navTo(pageId, element) {
            // সব পেজ লুকাও
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            // সব নব আইটেম ডি-অ্যাক্টিভ করো
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            // টার্গেট পেজ দেখাও
            document.getElementById(pageId).classList.add('active');
            if(element) element.classList.add('active');

            if(pageId === 'rank-page') generateRankings();
        }

        function startApp() {
            document.getElementById('welcome-popup').style.display = 'none';
            document.getElementById('app-wrapper').style.display = 'flex';
        }

        // --- ৫. অ্যাড লজিক (Adsgram Handling) ---
        function handleWatchAd() {
            let today = new Date().toDateString();
            db.ref('users/' + userId).once('value', (snap) => {
                let user = snap.val() || { coins: 0, dailyAds: 0, lastDate: "" };
                let currentDaily = (user.lastDate === today) ? user.dailyAds : 0;

                if(currentDaily >= (window.maxLimit || 50)) {
                    tg.showAlert("আপনার আজকের লিমিট শেষ! আগামীকাল আবার চেষ্টা করুন।");
                    return;
                }

                AdController.show().then(() => {
                    db.ref('users/' + userId).update({
                        coins: (user.coins || 0) + 25,
                        dailyAds: currentDaily + 1,
                        lastDate: today,
                        name: uName, photo: uPic
                    });
                    tg.showAlert("অভিনন্দন! আপনি ২৫ কয়েন পেয়েছেন।");
                }).catch(() => tg.showAlert("অ্যাড লোড হয়নি, আবার চেষ্টা করুন।"));
            });
        }

        // --- ৬. ফেক র‍্যাঙ্কিং (Leaderboard) ---
        function generateRankings() {
            let html = "";
            let fakeUsers = [];
            for(let i=1; i<=100; i++) {
                fakeUsers.push({
                    name: "Apex_User_" + (i + 120),
                    coins: 120000 - (i * 950),
                    img: `https://api.dicebear.com/7.x/pixel-art/svg?seed=${i}`
                });
            }
            fakeUsers.forEach((u, index) => {
                html += `
                <div class="list-item">
                    <div style="display:flex; align-items:center;">
                        <span style="font-weight:900; color:var(--primary); width:30px;">#${index+1}</span>
                        <img src="${u.img}" class="user-avatar">
                        <span>${u.name}</span>
                    </div>
                    <b style="color:var(--accent);">${u.coins.toLocaleString()}</b>
                </div>`;
            });
            document.getElementById('leaderboard-list').innerHTML = html;
        }
    </script>
</body>
</html>
